@model PBL3.Models.ViewModel.TicketViewModel
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Các gói đăng ký</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/BuyTicket.css" asp-append-version="true" />
</head>
<body>
    <h1>Các gói hiện có</h1>
    <div class="package-container">
        <div class="package">
            <h3>Gói 1 Tháng</h3>
            <div class="price">50.000đ</div>
            <ul class="features">
                <li>Giữ xe 24/7</li>
                <li>Bảo hiểm xe</li>
                <li>Thẻ xe điện tử</li>
                <li class="highlight">Gói cơ bản</li>
            </ul>
            <button class="register-btn" onclick="openModal('Gói 1 Tháng')">Đăng Ký Ngay</button>
        </div>

        <div class="package">
            <h3>Gói 3 Tháng</h3>
            <div class="price">120.000đ</div>
            <ul class="features">
                <li>Giữ xe 24/7</li>
                <li>Bảo hiểm xe</li>
                <li>Thẻ xe điện tử</li>
                <li class="highlight">Giảm 20% tổng giá</li>
            </ul>
            <button class="register-btn" onclick="openModal('Gói 3 Tháng')">Đăng Ký Ngay</button>
        </div>

        <div class="package">
            <h3>Gói 6 Tháng</h3>
            <div class="price">200.000đ</div>
            <ul class="features">
                <li>Giữ xe 24/7</li>
                <li>Bảo hiểm xe</li>
                <li>Thẻ xe điện tử</li>
                <li class="highlight">Giảm 33% tổng giá</li>
            </ul>
            <button class="register-btn" onclick="openModal('Gói 6 Tháng')">Đăng Ký Ngay</button>
        </div>
    </div>

    <!-- License Plate Modal -->
    <div id="licenseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 class="modal-title">Đăng ký <span id="packageName"></span></h2>
            <p>Vui lòng nhập biển số xe của bạn:</p>
            <div class="input-container">
                <input type="text" id="licensePlate" class="license-plate-input" placeholder="VD: 51A-12345">
                <button class="continue-btn" onclick="continueRegistration()">Tiếp tục</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="confirmation-modal">
        <div class="confirmation-content">
            <header class="confirmation-header">
                <div class="success-icon-wrapper">
                    <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="success-icon">
                        <g clip-path="url(#clip0_7_293)">
                            <path d="M21.0594 4.94061C21.6453 5.52655 21.6453 6.47811 21.0594 7.06405L9.05938 19.0641C8.47344 19.65 7.52188 19.65 6.93594 19.0641L0.935944 13.0641C0.350006 12.4781 0.350006 11.5266 0.935944 10.9406C1.52188 10.3547 2.47344 10.3547 3.05938 10.9406L8.00001 15.8766L18.9406 4.94061C19.5266 4.35468 20.4781 4.35468 21.0641 4.94061H21.0594Z" fill="#10B981" />
                        </g>
                        <defs>
                            <clipPath id="clip0_7_293">
                                <path d="M0.5 0H21.5V24H0.5V0Z" fill="white" />
                            </clipPath>
                        </defs>
                    </svg>
                </div>
                <h2 class="confirmation-message">Xác nhận đăng ký gói giữ xe</h2>
            </header>

            <article class="student-info-section">
                <h3 class="section-title">Thông tin sinh viên</h3>
                <div class="info-grid">
                    <div class="info-row">
                        <span class="info-label">Họ và tên:</span>
                        <span class="info-value">@Model.HoTen</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">MSSV:</span>
                        <span class="info-value">@Model.MSSV</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lớp:</span>
                        <span class="info-value">@Model.Lop</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Gói giữ xe:</span>
                        <span class="info-value" id="confirmPackageName">Gói 3 tháng</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ngày hết hạn:</span>
                        <span class="info-value" id="expiryDate">05/08/2025</span>
                    </div>
                </div>
            </article>

            <section class="vehicle-info-section">
                <h3 class="section-title">Thông tin xe</h3>
                <div class="vehicle-input-group">
                    <span class="info-label">Biển số:</span>
                    <span class="info-value" id="confirmLicensePlate">B05A082025</span>
                </div>
            </section>

            <footer class="action-buttons">
                <button class="print-button" onclick="confirmRegistration()">
                    <span>Xác nhận</span>
                </button>
                <button class="cancel-button" onclick="closeConfirmationModal()">Hủy</button>
            </footer>
        </div>
    </div>

    <script>
        // Lấy các modal
        var licenseModal = document.getElementById("licenseModal");
        var confirmationModal = document.getElementById("confirmationModal");
        var currentPackage = "";

        // Hàm mở modal nhập biển số
        function openModal(packageName) {
            currentPackage = packageName;
            document.getElementById("packageName").textContent = packageName;
            licenseModal.style.display = "block";
        }

        // Hàm đóng modal nhập biển số
        function closeModal() {
            licenseModal.style.display = "none";
        }

        // Hàm khi nhấn tiếp tục
        function continueRegistration() {
            var licensePlate = document.getElementById("licensePlate").value;
            if (licensePlate.trim() === "") {
                alert("Vui lòng nhập biển số xe");
                return;
            }

            // Tính ngày hết hạn dựa trên gói đăng ký
            var expiryDate = calculateExpiryDate(currentPackage);

            // Cập nhật thông tin trong modal xác nhận
            document.getElementById("confirmPackageName").textContent = currentPackage;
            document.getElementById("confirmLicensePlate").textContent = licensePlate;
            document.getElementById("expiryDate").textContent = expiryDate;

            // Đóng modal nhập biển số và mở modal xác nhận
            closeModal();
            confirmationModal.style.display = "block";
        }

        // Hàm tính ngày hết hạn
        function calculateExpiryDate(packageName) {
            var today = new Date();
            var expiryDate = new Date();

            if (packageName.includes("1 Tháng")) {
                expiryDate.setMonth(today.getMonth() + 1);
            } else if (packageName.includes("3 Tháng")) {
                expiryDate.setMonth(today.getMonth() + 3);
            } else if (packageName.includes("6 Tháng")) {
                expiryDate.setMonth(today.getMonth() + 6);
            }

            // Format ngày thành dd/mm/yyyy
            var day = expiryDate.getDate();
            var month = expiryDate.getMonth() + 1;
            var year = expiryDate.getFullYear();

            return (day < 10 ? '0' : '') + day + '/' +
                   (month < 10 ? '0' : '') + month + '/' +
                   year;
        }

        // Hàm xác nhận đăng ký
        function confirmRegistration() {
            alert("Đăng ký thành công!");
            closeConfirmationModal();
        }

        // Hàm đóng modal xác nhận
        function closeConfirmationModal() {
            confirmationModal.style.display = "none";
            // Reset biển số xe
            document.getElementById("licensePlate").value = "";
        }

        // Đóng modal khi nhấn ra ngoài
        window.onclick = function(event) {
            if (event.target == licenseModal) {
                closeModal();
            }
            if (event.target == confirmationModal) {
                closeConfirmationModal();
            }
        }
    </script>
</body>
</html>